<pxt-passthrough>
<pxt-use class="Sniglets::HTML"/>
<pxt-use class="Sniglets::Users"/>
<pxt-use class="Grail::Frame"/>
<grail-canvas-template base="/templates/equals_sign.pxt" mode="main_canvas">
<div class="rhn-embedded-help">
<div class="rhn-embedded-help-NAVHEADER">
<table summary="Header navigation table" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<th colspan="3" align="center">RHN Proxy Server 2.1: Installation Guide</th>
</tr>
<tr>
<td width="10%" align="left" valign="bottom">
<a href="http-cache-config.html">
<img src="/img/list-backward.gif" alt="Previous" border="0"/>
</a>
</td>
<td width="80%" align="center" valign="bottom">Appendix G. Manual Installation and Configuration</td>
<td width="10%" align="right" valign="bottom">
<a href="auth-daemon.html">
<img src="/img/list-forward.gif" alt="Next" border="0"/>
</a>
</td>
</tr>
</table>
</div>
<div class="rhn-embedded-help-SECT1">
<h2><a name="RHNS-PROXY-BROKER"/>G.4. RHN Proxy Broker Server</h2>
<p>        After installing the Apache Web Server, installing and configuring the HTTP proxy caching server,
        and installing the RHN Authentication Daemon, it is time to start installing and
        configuring the RHN Proxy Broker Server component:
      </p>
<p/>
<ol type="1">
<li>
<p>The hardware clock of the system that will act as the RHN Proxy Broker Server must
	    be set to UTC.
	  </p>
<div class="rhn-embedded-help-WARNING">
<p/>
<table class="rhn-embedded-help-WARNING" width="90%" border="0">
<tr>
<td width="25" align="CENTER" valign="TOP">
<img src="./stylesheet-images/warning.png" hspace="5" alt="Warning"/>
</td>
<th align="LEFT" valign="CENTER">
<strong>Warning</strong>
</th>
</tr>
<tr>
<td>&#xA0;</td>
<td align="LEFT" valign="TOP">
<p>              There is great time sensitivity when connecting to a Web server
              running SSL; it is imperative the time settings on the
              clients and server are reasonably close together so the SSL
              certificate does not expire too quickly. It is recommended
              NTP be used to synchronize the clocks.</p>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Before installing the <tt class="rhn-embedded-help-FILENAME">rhns-proxy-broker</tt> RPM
	    package, the Red Hat Linux system that will act as the RHN Proxy Broker Server must be
	    registered with Spacewalk as a client. Run the Spacewalk Registration Client on the system with
	    the <tt class="rhn-embedded-help-COMMAND">rhn_register</tt> command. It gathers software and
	    hardware information about the system, sends the information to the RHN
	    servers, and generates a unique Digital Certificate on the system in the
	    file <tt class="rhn-embedded-help-FILENAME">/etc/sysconfig/rhn/systemid</tt>. 
	  </p>
</li>
<li>
<p>The Digital Certificate file must exist before the
	    <tt class="rhn-embedded-help-FILENAME">rhns-proxy-broker</tt> RPM package can be installed
	    with the command:
	  </p>
<table class="rhn-embedded-help-SCREEN" bgcolor="#DCDCDC" width="90%">
<tr>
<td>
<pre class="rhn-embedded-help-SCREEN">
<tt class="rhn-embedded-help-COMMAND">rpm -Uvh rhns-proxy-broker-<tt class="rhn-embedded-help-REPLACEABLE"><em>&lt;version-number&gt;</em></tt>.rpm</tt>
</pre>
</td>
</tr>
</table>
<p>The RHN Proxy Broker Server uses this Digital Certificate for authentication
	    purposes.  The post section of the package changes the ownership and
	    permissions of the Digital Certificate file
	    (<tt class="rhn-embedded-help-FILENAME">/etc/sysconfig/rhn/systemid</tt>) if it exists. It
	    will exist if you have already registered the system with
	    RHN. Verify that this file is owned by root.apache and has the
	    permissions 0640. Because the RHN Proxy Broker Server is an extension of Apache,
	    the apache user must be able to access the file.
          </p>
<p>While installing the <tt class="rhn-embedded-help-FILENAME">rhns-proxy-broker</tt> package,
	    you must also install the <tt class="rhn-embedded-help-FILENAME">rhns</tt> and
	    <tt class="rhn-embedded-help-FILENAME">rhns-certs-tools</tt> packages and
	    their dependencies listed in <a href="requirements.html#SOFTWARE-REQUIREMENTS">Section 2.1 <em>Software Requirements</em></a>.
	  </p>
<p>The RHN Proxy Broker Server code is installed in
	    <tt class="rhn-embedded-help-FILENAME">/var/www/rhns/proxy</tt> and
	    <tt class="rhn-embedded-help-FILENAME">/var/www/rhns/common</tt> directories.  Settings are
	    configured in <tt class="rhn-embedded-help-FILENAME">/etc/rhn/rhn.conf</tt>.
	  </p>
</li>
<li>
<p>	    During the configuration of the Apache Web Server, the
	    <tt class="rhn-embedded-help-FILENAME">conf/rhn_proxy_broker.conf</tt> file should have
	    been included in the <tt class="rhn-embedded-help-FILENAME">httpd.conf</tt> Apache
	    configuration file. Edit the
	    <tt class="rhn-embedded-help-FILENAME">rhn_proxy_broker.conf</tt> file to control access to
	    the RHN Proxy Broker Server.
	  </p>
</li>
<li>
<p>The <tt class="rhn-embedded-help-FILENAME">/etc/rhn/rhn.conf</tt> configuration file is
	    divided into four sections: the common section, the RHN Proxy Broker Server
	    section, the RHN Proxy SSL Redirect Server section, and the RHN Authentication Daemon section. The
	    settings in the common section apply globally and can be overridden
	    in the RHN Proxy Broker Server, RHN Proxy SSL Redirect Server, and RHN Authentication Daemon sections. All directives
	    in the RHN Proxy Broker Server section begin with <tt class="rhn-embedded-help-COMMAND">proxy.broker</tt>, all
	    directives in the RHN Proxy SSL Redirect Server section begin with
	    <tt class="rhn-embedded-help-COMMAND">proxy.redirect</tt>, and all directives in the RHN Authentication Daemon
	    section begin with <tt class="rhn-embedded-help-COMMAND">auth_cache</tt>.
	  </p>
<p>	    In the common section, at a minimum, set the
	    <tt class="rhn-embedded-help-COMMAND">traceback_mail</tt> variable. 
	  </p>
<table class="rhn-embedded-help-SCREEN" bgcolor="#DCDCDC" width="90%">
<tr>
<td>
<pre class="rhn-embedded-help-SCREEN">
<tt class="rhn-embedded-help-COMPUTEROUTPUT"># ___traceback mail___
traceback_mail = root@mycompany.com, bob@mycompany.com</tt>
</pre>
</td>
</tr>
</table>
</li>
<li>
<p>The <tt class="rhn-embedded-help-COMMAND">debug</tt> variable can also be set for
	    debugging purposes. The higher the number, the more debugging messages
	    are written to the log file. The highest debug number is 6, and the
	    default value is 5.
	  </p>
<div class="rhn-embedded-help-TABLE">
<a name="DEBUG-LEVELS"/>
<table border="1" bgcolor="#DCDCDC" cellspacing="0" cellpadding="4" class="rhn-embedded-help-CALSTABLE">
<thead>
<tr>
<th width="25%" align="LEFT" valign="TOP">Debug Level</th>
<th width="75%" align="LEFT" valign="TOP">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td width="25%" align="LEFT" valign="TOP">0</td>
<td width="75%" align="LEFT" valign="TOP">Almost nothing is logged.</td>
</tr>
<tr>
<td width="25%" align="LEFT" valign="TOP">1</td>
<td width="75%" align="LEFT" valign="TOP">Write a minimal amount of messages to the log
		    files.</td>
</tr>
<tr>
<td width="25%" align="LEFT" valign="TOP">2</td>
<td width="75%" align="LEFT" valign="TOP">Write a reduced amount of messages to the log
		    files.</td>
</tr>
<tr>
<td width="25%" align="LEFT" valign="TOP">3</td>
<td width="75%" align="LEFT" valign="TOP">Write most function and method calls to the log
		    files.</td>
</tr>
<tr>
<td width="25%" align="LEFT" valign="TOP">4</td>
<td width="75%" align="LEFT" valign="TOP">Write verbose messages to the log files.</td>
</tr>
<tr>
<td width="25%" align="LEFT" valign="TOP">5</td>
<td width="75%" align="LEFT" valign="TOP">Write very verbose messages to the log files.</td>
</tr>
<tr>
<td width="25%" align="LEFT" valign="TOP">6</td>
<td width="75%" align="LEFT" valign="TOP">Write very, very verbose messages to the log files. This
		    value should only be used by developers.</td>
</tr>
</tbody>
</table>
<p>
<strong>Table G-1. <tt class="rhn-embedded-help-COMMAND">debug</tt> levels</strong>
</p>
</div>
<p>For example:</p>
<table class="rhn-embedded-help-SCREEN" bgcolor="#DCDCDC" width="90%">
<tr>
<td>
<pre class="rhn-embedded-help-SCREEN">
<tt class="rhn-embedded-help-COMPUTEROUTPUT"># ___logging___
debug          = 2  # I want a minimal amount of debugging.</tt>
</pre>
</td>
</tr>
</table>
</li>
<li>
<p>At a minimum, set following variables in the RHN Proxy Broker Server section:
	  </p>
<table class="rhn-embedded-help-SCREEN" bgcolor="#DCDCDC" width="90%">
<tr>
<td>
<pre class="rhn-embedded-help-SCREEN">
<tt class="rhn-embedded-help-COMPUTEROUTPUT"># ___this proxy broker's downstream parent or redirect server___
# proxy.broker.rhn_parent = xmlrpc.rhn.redhat.com/XMLRPC
proxy.broker.rhn_parent = rhn_ssl_redirect_box.mycompany.com/XMLRPC_REDIRECT

# ___this proxy broker's cache (e.g. squid)___
proxy.broker.http_proxy        = squid1.mycompany.com:8080
proxy.broker.auth_cache_server = 127.0.0.1</tt>
</pre>
</td>
</tr>
</table>
<div class="rhn-embedded-help-IMPORTANT">
<p/>
<table class="rhn-embedded-help-IMPORTANT" width="90%" border="0">
<tr>
<td width="25" align="CENTER" valign="TOP">
<img src="./stylesheet-images/important.png" hspace="5" alt="Important"/>
</td>
<th align="LEFT" valign="CENTER">
<strong>Important</strong>
</th>
</tr>
<tr>
<td>&#xA0;</td>
<td align="LEFT" valign="TOP">
<p>	      <tt class="rhn-embedded-help-COMMAND">proxy.broker.rhn_parent</tt> must be set to a fully
	      qualified URL that can be resolved by all RHN Proxy Server components or a
	      valid IP address. If any component resides on a different machine
	      (outside of the machine that acts as the RHN Proxy Broker Server),
	      <tt class="rhn-embedded-help-COMMAND">proxy.broker.rhn_parent</tt> should not be set to
	      127.0.0.1 or localhost. If it is set to 127.0.0.1 or localhost,
	      the other components may not be able to resolve the URL or IP
	      address to the correct server.
	    </p>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>If you are not using an RHN Proxy SSL Redirect Server, set the
	    <tt class="rhn-embedded-help-COMMAND">proxy.broker.rhn_parent</tt> directive to
	    <tt class="rhn-embedded-help-USERINPUT"><strong>xmlrpc.rhn.redhat.com/XMLRPC</strong></tt>.
	  </p>
</li>
<li>
<p>If the port number for the RHN Authentication Daemon is not the default port of
	    9999, set the <tt class="rhn-embedded-help-COMMAND">proxy.broker.auth_cache_server_port</tt> in
	    the configuration file on the RHN Proxy Broker Server.
	  </p>
</li>
<li>
<p>If you configure the RHN Package Manager, you must specify the stored
	    packages directory. By default, the RHN Package Manager stores packages in the
	    <tt class="rhn-embedded-help-FILENAME">/var/up2date/packages</tt> directory. If the RHN Package Manager
	    is configured to store packages in a different directory, that
	    directory must be declared in <tt class="rhn-embedded-help-FILENAME">rhn.conf</tt>:
	  </p>
<table class="rhn-embedded-help-SCREEN" bgcolor="#DCDCDC" width="90%">
<tr>
<td>
<pre class="rhn-embedded-help-SCREEN">
<tt class="rhn-embedded-help-COMPUTEROUTPUT">proxy.broker.pkg_dir = /var/up2date/packages</tt>
</pre>
</td>
</tr>
</table>
</li>
</ol>
<p>        The <tt class="rhn-embedded-help-FILENAME">/var/log/rhn/rhn_proxy_broker.log</tt> file
        contains the log messages for the RHN Proxy Broker Server. The
        <tt class="rhn-embedded-help-COMMAND">proxy.broker.debug</tt> directive in
        <tt class="rhn-embedded-help-FILENAME">rhn.conf</tt> determines how verbose the log messages
        are for the RHN Proxy Broker Server. Refer to <a href="rhns-proxy-broker.html#DEBUG-LEVELS">Table G-1</a> for an
        explanation of the debug values.
      </p>
<div class="rhn-embedded-help-WARNING">
<p/>
<table class="rhn-embedded-help-WARNING" width="100%" border="0">
<tr>
<td width="25" align="CENTER" valign="TOP">
<img src="./stylesheet-images/warning.png" hspace="5" alt="Warning"/>
</td>
<th align="LEFT" valign="CENTER">
<strong>Warning</strong>
</th>
</tr>
<tr>
<td>&#xA0;</td>
<td align="LEFT" valign="TOP">
<p>          Modifications of <tt class="rhn-embedded-help-FILENAME">/etc/rhn/rhn.conf</tt> take effect
          immediately, but if modifying any httpd
          <tt class="rhn-embedded-help-FILENAME">/etc/httpd/conf/*.conf</tt> file, one must &quot;bounce&quot;
          the HTTP server with the command
          <tt class="rhn-embedded-help-COMMAND">/sbin/service httpd restart</tt>
        </p>
</td>
</tr>
</table>
</div>
</div>
<div class="rhn-embedded-help-NAVFOOTER">
<table summary="Footer navigation table" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td width="33%" align="left" valign="top">
<a href="http-cache-config.html">
<img src="/img/list-backward.gif" alt="Previous" border="0"/>
</a>
</td>
<td width="34%" align="center" valign="top">
<a href="index.html" accesskey="H">Home</a>
</td>
<td width="33%" align="right" valign="top">
<a href="auth-daemon.html">
<img src="/img/list-forward.gif" alt="Next" border="0"/>
</a>
</td>
</tr>
<tr>
<td width="33%" align="left" valign="top">HTTP Proxy Caching Server Configuration</td>
<td width="34%" align="center" valign="top">
<a href="install-configure.html" accesskey="U">Up</a>
</td>
<td width="33%" align="right" valign="top">RHN Authentication Daemon</td>
</tr>
</table>
</div>
</div>
</grail-canvas-template>
</pxt-passthrough>
