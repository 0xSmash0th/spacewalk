#!/bin/bash
#
# notif-init: This shell script enables the automatic use of the notification
#             system for monitoring.  This is a simple init script that does
#             not use SysVStep.
#
# Author:       Karen Jacqmin-Adams <kja@redhat.com>
#
#

# source function library
. /etc/rc.d/init.d/functions

lockfile=/var/lock/subsys/notif
gogo=/usr/bin/gogo.pl 

RETVAL=0

start() {
	echo -n $"Starting notification: "
  $gogo --fname=NotifEscalator --command=/usr/bin/notif-escalator  --user nocpulse --hbfile=/var/log/nocpulse/notif-escalator.log  --hbfreq=300 --hbcheck=600 > /var/log/notification/NotifEscalator-error.log 2>&1 && \
  $gogo --fname=AckProcessor --command=/usr/bin/ack-processor --user nocpulse --hbfile=/var/tmp/ack_handler.log  --hbfreq=300 --hbcheck=600 > /var/log/nocpulse/AckProcessor-error.log 2>&1 && \
  $gogo --fname=NotifLauncher --command=/usr/bin/notif-launcher --user nocpulse --hbfile=/var/log/nocpulse/notif-launcher.log  --hbfreq=300 --hbcheck=600 > /var/log/nocpulse/NotifLauncher-error.log 2>&1 && \
  $gogo --fname=Notifier --command="/usr/bin/notifier" --user nocpulse --hbfile=/var/log/nocpulse/notifier --hbfreq=300 --hbcheck=600 > /var/log/nocpulse/Notifier-error.log 2>&1 && \
  
	touch "$lockfile" && success || failure
	RETVAL=$?
	echo
}

stop() {
	echo -n $"Stopping notification: "
  $gogo --kill --fname=Notifier --command=/usr/bin/notifier--user nocpulse --hbfile=/var/log/nocpulse/notifier --hbfreq=300 --hbcheck=600 -&& \
  $gogo --kill --fname=NotifLauncher --command=/usr/bin/notif-launcher --user nocpulse --hbfile=/var/log/nocpulse/notif-launcher.log  --hbfreq=300 --hbcheck=600 && \
  $gogo --kill --fname=AckProcessor --command=/usr/bin/ack-processor --user nocpulse --hbfile=/var/tmp/ack_handler.log  --hbfreq=300 --hbcheck=600 && \
  $gogo --kill --fname=NotifEscalator --command=/usr/bin/notif-escalator --user nocpulse --hbfile=/var/log/nocpulse/notif-escalator.log  --hbfreq=300 --hbcheck=600 && \
	rm -f "$lockfile" && success || failure
	RETVAL=$?
	echo
}

restart() {
	stop
	start
}

case "$1" in
  start)
	start
	;;
  stop) 
	stop
	;;
  restart|force-reload)
	restart
	;;
  reload)
	;;
  condrestart)
	[ -f "$lockfile" ] && restart
	;;
  status)
	if [ -f $lockfile ]; then
		echo $"Notification is running."
		RETVAL=0
	else
		echo $"Notification is stopped."
		RETVAL=3
	fi
	;;
  *)
	echo $"Usage: $0 {start|stop|status|restart|reload|force-reload|condrestart}"
	exit 1
esac

exit $RETVAL
