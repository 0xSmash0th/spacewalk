
package NOCpulse::SatConfig::test::TestBootstrap;

use strict;

use LWP::UserAgent;
use HTTP::Request;

use base qw(Test::Unit::TestCase);

sub test_bootstrap
{
    my $self = shift;

    my $params = 'mac=00:D0:B7:89:0B:4F&publickey=1024%2035%20113867910605339984538720845704338898691752314787198396301227121305585636912678630005446925256279273561626528276891819877014778733851036125556380573916105661180016955775212530273097562061271577961504480942454572648438314860766726659887891073737219797585242606092936130517992250088583926366617479566264039444983%20sat-qa-0000%0A&cert=-----BEGIN%20CERTIFICATE-----%0AMIIFkDCCBHigAwIBAgIBAzANBgkqhkiG9w0BAQUFADCBsTELMAkGA1UEBhMCVVMx%0AEzARBgNVBAgTCkNhbGlmb3JuaWExEjAQBgNVBAcTCVN1bm55dmFsZTEXMBUGA1UE%0AChMOTk9DcHVsc2UsIEluYy4xEzARBgNVBAsTCk9wZXJhdGlvbnMxKjAoBgNVBAMT%0AIU5PQ3B1bHNlIERldiBTYXRlbGxpdGUgU3lzdGVtcyBDQTEfMB0GCSqGSIb3DQEJ%0AARYQb3BzQG5vY3B1bHNlLmNvbTAeFw0wMTEwMDIyMTQ5MzVaFw0wMjEwMDIyMTQ5%0AMzVaMIGrMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTESMBAGA1UE%0ABxMJU3Vubnl2YWxlMRcwFQYDVQQKEw5OT0NwdWxzZSwgSW5jLjETMBEGA1UECxMK%0AT3BlcmF0aW9uczEkMCIGA1UEAxMbY3Jhc2gtdGVzdC5kZXYubm9jcHVsc2UubmV0%0AMR8wHQYJKoZIhvcNAQkBFhBvcHNAbm9jcHVsc2UuY29tMIGfMA0GCSqGSIb3DQEB%0AAQUAA4GNADCBiQKBgQDdk%2Bez7J5ZHaYk7G%2Fp9B9xPIBBt2t3jfwQTI2eZuToIjT%2F%0AT3ZaOqEHCGN99ik2bL6gAYv25SPCxhvWOMqWr7T4oC8oA5fUxR3ActXhoctj%2FB9c%0AJ5dNXjDoKtJzfg8XR%2BRHq0N8dOc86L%2FdT1Tjt2Ga7Jx4Oftps7FqLRCB0DTX9wID%0AAQABo4ICOTCCAjUwCQYDVR0TBAIwADA0BglghkgBhvhCAQ0EJxYlTk9DcHVsc2Ug%0AU2F0ZWxsaXRlIFN5c3RlbSBDZXJ0aWZpY2F0ZTAdBgNVHQ4EFgQUtHsswP8AEB25%0AVQ6ci%2Beb%2BrjuIaUwgdQGA1UdIwSBzDCByYAUAg6S1kBw7sQ8%2BiC3v6OCswe%2Bk9mh%0Aga2kgaowgacxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRIwEAYD%0AVQQHEwlTdW5ueXZhbGUxFzAVBgNVBAoTDk5PQ3B1bHNlLCBJbmMuMRMwEQYDVQQL%0AEwpPcGVyYXRpb25zMSAwHgYDVQQDExdOT0NwdWxzZSBEZXYgU3lzdGVtcyBDQTEf%0AMB0GCSqGSIb3DQEJARYQb3BzQG5vY3B1bHNlLmNvbYIBAjA0BglghkgBhvhCAQME%0AJxYlaHR0cDovL3d3dy5ub2NwdWxzZS5jb20vY2VydHMvY3JsLnBlbTA3BglghkgB%0AhvhCAQcEKhYoaHR0cDovL3d3dy5ub2NwdWxzZS5jb20vY2VydHMvcmVuZXcuaHRt%0AbDA6BglghkgBhvhCAQgELRYraHR0cDovL3d3dy5ub2NwdWxzZS5jb20vY2VydHMv%0AY2Fwb2xpY3kuaHRtbDAxBglghkgBhvhCAQQEJBYiaHR0cDovL3d3dy5ub2NwdWxz%0AZS5jb20vY2EtY3JsLnBlbTARBglghkgBhvhCAQEEBAMCBsAwCwYDVR0PBAQDAgWg%0AMA0GCSqGSIb3DQEBBQUAA4IBAQB6HDt0Q%2FINQBhbp0b8EiV7%2FykOk6jeXOP807BD%0AVWUwUqCJ1nHgloIKffWLxveaDb5%2FjcrH8j5IUtSdc11kW3iaWazw8NFvuVOcBfT%2B%0AWNfYJ7GErPUXDrk54jzUS%2Fd2Jn%2F0HPi%2B8T99N%2Bij58E5ZePtBX0aYUc4keFXrJlq%0Aujhrb9vWxkxQtIItsZqWoa%2F6MbBR%2FuPjKpOjE0JDQsPMLNjUvC8H3ds6tJO2lxu1%0A8UJzoKbW9r89eHSxRu%2FnHesLXiyahYGCfW39YfTxvg15bNZzozg8QaFRYP9hto7V%0AqFaFBCymJk79tfeHaYhEbGjQisaw04xXC8d2KIBbLO%2BQuRBl%0A-----END%20CERTIFICATE-----%0A&certhash=c4ee54de.0';

    my $request = HTTP::Request->new('POST', 'handler://NOCpulse::SatConfig::Bootstrap');
    $request->content($params);

    my $ua = LWP::UserAgent->new();
    my $response = $ua->request($request);

    my $success = $response->is_success;
    my $status_line = $response->status_line();
    
    $self->assert( $status_line =~ /200/, "bootstrap with valid arguments should return OK");
    
    my $content = $response->content();
    $self->assert( $content =~ /^0:10632:10633:/, "bootstrap with sat-39's info should return 10632");
    
}

1;




